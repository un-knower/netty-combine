## 用MD5验证上传文件的完整性

<p> 在项目的开发资源开发中，测试发现一个问题：将资源上传到服务器上，提示已经上传成功，但是当打开这个文件时发现失败，由于各种原因资源已经毁坏。怎么样能保证资源的完整性，处理办法就是用MD5验证文件的完整性。</p>

<p> 任何一个字符串或文件，无论是可执行程序、图像文件、临时文件或者其他任何类型的文件，也不管它体积多大，都有且只有一个独一无二的MD5信息码，并且如果这个文件被修改过，它的MD5码也将随之改变。 </p>


断点意味着网络会断，然后断了之后，服务端根本获取不到本次上传的内容，于是下次又只能从头开始传文件。一种解决办法是客户端将文件分成很小的片段（单个片段丢了就整个片段重传），这个方案要求客户端做很多工作，服务端还得根据片段的编号组织文件，总之客户端和服务端都挺麻烦。

于是就想到用netty在写一个服务filestoreApdapterServer，文件上传提交给这个代理服务。这个做法有个前提就是，客户端上传的文件名称保证唯一，并且在请求头里面带着这个名字，以便服务端定位文件。利用的原理是一般长度比较大的消息体，netty会使用chunk传输，我们取得chunk写入临时文件，这样即使网络断了，服务端已经获取的文件内容还是保留在临时文件里面。

流程如下：

     1. filestoreApdapterServer将请求的消息体写到临时文件（网络断了也不要紧，读到多少写多少）。

     2. 客户端下次传之前先调用getSize获取上传传递的文件长度，我们就在这个getSize方法里面偷偷的将第一步保存的临时文件追加到正式文件里面，然后返回文件长度。

     3. 客户端根据获取的服务端文件长度，定位未传的文件位置，读取上传。重复1，2步骤。直到文件上传完成。
     
## 如何防止MD5秒传

### 1.秒传的原理的详细解释　　

上传到网盘的每个文件，服务器都会校验MD5码。如果这个您上传的文件MD5码与已经存在于服务器里的文件的MD5码相同的话，网盘服务器将会判断成为重复文件，只需要复制副本保存在网盘上即可，无需重新保存，因为有过目前这个文件，于是很快完成上传任务，并在有人需要下载的时候将原有的该文件的下载地址放出。这样实现了服务器的高效运作。

### 2.怎样不秒传？　

　把你要上传的东西压缩成RAR，东西上传，服务器会先做MD5校验，如果服务器上有一样的东西，它就直接给你个新地址，其实你下载的都是服务器上的同一个文件，想要不秒传，其实只要让MD5改变，就是对文件本身做一下修改（改名字不行），例如一个文本文件，你多加几个字，MD5就变了，就不会秒传了。　　但是有些文件我们不好改变，也不想改变，那其实只要压缩一下，MD5就变了，

而下载的人也能获得最原始的资料，不过就是加压要花费一点时间。